### 1,什么是tcp链接

其中的主要概念：socket+序列号+窗口大小（滑动窗口大小，防止接收方缓冲区溢出，也可根据网络状态调整发送速率）

### tcp的意义

为了解决流量控制以及拥塞控制（可靠性控制，按序控制，流量控制，拥塞控制）


### tcp和udp的区别

tcp面向连接

拥有：可靠性控制，按序控制，流量控制，拥塞控制

但是udp是无连接的协议，不保证数据的可靠性，但是快，udp可以用做对数据量要求高的场景，比如直播和游戏

### tcp的粘包和拆包问题

本质上就是将多个打包的东西压缩成一个包进行传输

这些问题只会在tcp协议的传输中出现，tcp的报文不存在报文长度，而udp存在报文长度

#### 粘包问题

##### 本质：多个数据被合并为一个数据包（序列化器和反序列化器）

##### 1，定时器

定时发送（高并发下很差，除非这个数据量大到吃满带宽）

#### 拆包问题的本质：

将一个完成的数据包拆分为多个部分发送（比如说rpc中我们将类型表和数据表进行拆解）

#### 拆包解决方案：

##### 1，固定长度的协议（比如手写rpc框架中就固定了每次传输的长度）

##### 2，添加一个长度头部

##### 3，特殊分隔符





### tcp协议的三次握手（链接建立阶段）和四次挥手

#### 先说说原因吧，三次握手的目的是避免错误链接的建立，减少少双方的通讯损耗。

如果握手两次，则无法阻止历史链接的建立，三次握手（发送序号给接收方，返回序号和发送方期望的接受码，发送方返回确认以及期望码）

![image.png](https://pic.code-nav.cn/mianshiya/question_picture/1772087337535152129/3Op5Vs3X_image_mianshiya.png)

### tcp协议，初始序列号ISN的规则

（递增值但是真实的需要加一些伪随机值）

### syn超时的办法（syn同步标志序号）（阶梯性重试）

### syn flood攻击

发一堆syn但是不接受ack![img](https://pic.code-nav.cn/mianshiya/question_picture/1772087337535152129/jBm3f6pv_8d87a3e7-9485-403f-a81c-0a55812e668b_mianshiya.png)

使得服务器的syn队列耗尽

#### 解决方案：减少重置次数，或者根据对方端口号生成一个cookie，便于确定是同一用户的链接

### 四次挥手（全双工协议，都要确认放弃才可以）

![img](https://pic.code-nav.cn/mianshiya/question_picture/1772087337535152129/VOHEPDBA_1a4be4e4-fd2a-4a90-a757-0dbbad90a633_mianshiya.png)

1. (B) --> ACK/FIN --> (A)

2. (B) <-- ACK <-- (A)

3. (B) <-- ACK/FIN <-- (A)

4. (B) --> ACK --> (A

由于TCP连接是双向连接, 因此关闭连接需要在两个方向上做。ACK/FIN 包(ACK 和FIN 标记设为1)通常被认为是FIN(终结)包.然而, 由于连接还没有关闭, FIN包总是打上ACK标记. 没有ACK标记而仅有FIN标记的包不是合法的包，并且通常被认为是恶意的

### 为什么需要time-wait

TCP协议中的TIME-WAIT状态是为了确保连接的可靠关闭和数据的一致性。具体来说，TIME-WAIT状态有两个主要原因：

1. **防止旧数据包干扰新连接**：假设没有TIME-WAIT状态，旧连接的数据包可能会在网络中延迟到达，并被新连接误认为是有效数据。这会导致数据错乱和各种不可预知的问题。通过保持TIME-WAIT状态，确保旧连接的数据包在网络中消失后，才允许使用相同的四元组（源地址、源端口、目的地址、目的端口）建立新连接]

2. **确保连接的可靠关闭**：在四次挥手过程中，主动关闭连接的一方在发送最后一个ACK包后进入TIME-WAIT状态。如果被动关闭的一方没有收到这个ACK包，会重发FIN包。TIME-WAIT状态确保主动关闭的一方能够接收到并处理这些重发的FIN包，从而保证连接的正确关闭]

   ## TCP结束

   ### arp和RARP
